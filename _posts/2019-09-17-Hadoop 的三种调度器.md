---
layout:     post
title:     Hadoop 的三种调度器FIFO、Capacity Scheduler、Fair Scheduler
subtitle:   大数据处理
date:       2019-09-17
author:     Yi Xia
header-img: img/post-bg-BJJ.jpg
catalog: true
tags:
    - 大数据处理
---

# Hadoop （Yarn） 的三种调度器FIFO、Capacity Scheduler、Fair Scheduler
    
  目前Hadoop有三种比较流行的资源调度器：FIFO 、Capacity Scheduler、Fair Scheduler。目前hadoop2.7默认使用的是Capacity Scheduler容量调度器。
## FIFO（先入先出调度器）
  hadoop1.x使用的默认调度器就是FIFO。FIFO采用队列方式将一个一个job任务按照时间先后顺序进行服务。比如排在最前面的job需要若干maptask和若干reducetask，当发现有空闲的服务器节点就分配给这个job，直到job执行完毕。
  ![-w915](/img/blog_img/15687187061863.jpg)
![-w433](/img/blog_img/15687197054198.jpg)

将所有application 按提交的顺序排队，先进先出
- 优点---->简单易懂且不用任何配置
- 缺点---->不适合于shared clusters；大的应用会将集群资源占满从而导致大量应用等待
- 小结：
1、一个队列可以使用yarn的全部资源；
2、后提交的任务必须等前面的任务运行完成之后，才可以得到资源并执行。

## Capacity Scheduler（容量调度器）
hadoop2.x使用的默认调度器是Capacity Scheduler。

1、支持多个队列，每个队列可配置一定量的资源，每个采用FIFO的方式调度。

2、为了防止同一个用户的job任务独占队列中的资源，调度器会对同一用户提交的job任务所占资源进行限制。

3、分配新的job任务时，首先计算每个队列中正在运行task个数与其队列应该分配的资源量做比值，然后选择比值最小的队列。比如如图队列A15个task，20%资源量，那么就是15/0.2=75，队列B是25/0.5=50 ，队列C是25/0.3=80.33 。所以选择最小值队列B。

4、其次，按照job任务的优先级和时间顺序，同时要考虑到用户的资源量和内存的限制，对队列中的job任务进行排序执行。

5、多个队列同时按照任务队列内的先后顺序一次执行。例如下图中job11、job21、job31分别在各自队列中顺序比较靠前，三个任务就同时执行。

![-w797](/img/blog_img/15687190321730.jpg)
![-w436](/img/blog_img/15687197187258.jpg)

小结：
最大化集群吞吐量
- 核心思想
 - 集群资源由多个队列分享
 - 空闲队列可以把资源“借”给忙队列
  - 需要时可以取回
- 调度策略
 - 应该获得的资源/实际获得的资源，选择比值最低的队列
 - 队列内FIFO
 

## Fair Scheduler（公平调度器）
1、支持多个队列，每个队列可以配置一定的资源，每个队列中的job任务公平共享其所在队列的所有资源。

2、队列中的job任务都是按照优先级分配资源，优先级越高分配的资源越多，但是为了确保公平每个job任务都会分配到资源。优先级是根据每个job任务的理想获取资源量减去实际获取资源量的差值决定的，差值越大优先级越高。
![-w821](/img/blog_img/15687191782753.jpg)
![-w431](/img/blog_img/15687198842228.jpg)

小结：
多用户公平共享集群资源
* 作业池
 - 每个用户单独资源池
 - 作业放进共享资源池
 - 每个作业最低资源保障
* 调度策略
 - 默认FIFO
 - 队列内调度策略可配置

## 三种调度方式的区别
1.当使用FIFO调度器时，小作业一直被阻塞，直至大作业完成。
	
2.使用容量调度器时，有一个独立队列保证小作业一提交就可以启动；但由于此队列容量是为该小作业保留的，因此这种策略是以整个集群的利用率为代价的，与FIFO调度器相比，大作业的执行时间更长

3.使用公平调度器时，不需要预留一定量的资源，因为调度器会在所有运行的作业之间**动态平衡资源**；从第二个作业的启动到公平共享资源之间会有时间滞后，因为必须等待第一个作业使用的容量用完并释放出资源。当小作业结束后不再申请资源后，大作业将回去再次使用全部的资源；
最后效果：即得到了较高集群使用率，又保证小作业能及时完成，不同于容量调度要单独分配一个队列用于小作业，实现的是动态的平衡资源。	
