---
layout:     post   				    # 使用的布局（不需要改）
title:      MongoDB实战				# 标题 
subtitle:   搭建集群 #副标题
date:       2019-06-27				# 时间
author:     summer					# 作者
header-img: img/post-bg-miui6.jpg 	#这篇文章标题背景图片
catalog: true 						# 是否归档
tags:								#标签
    - 数据库
---
## 单机配置(环境 centos 7)
1. 下载对应文件到指定目录
(1) 找到文件下载位置，解压文件
tar – zxvf mongodb − linux − x86_64 − 4.0.0. tgz
(2) 将解压后文件拷贝到指定目录下
mv mongodb − linux − x86􏰀􏰁 − 4.0.0 /mongodb
2. 创建相关目录及配置参数
  (1) mongodb 目录下创建数据存放目录
cd /mongodb
mkdir db (2) mongodb 目录下创建日志文件存放目录 mkdir logs
cd logs
touch mongodb. log
(3) bin 目录下创建主配置文件并进行修改
cd /mongodb/bin
touch mongodb. conf gedit mongodb. conf
(4) 进入配置文件，添加以下信息，保存关闭 dbpath =/mongodb/db
logpath =/mongodb/logs/mongodb. log port = 27017
fork = true nohttpinterface = true
3. 运行 mongodb
cd /mongodb/bin
./mongod − −bind_ip localhost − f ./mongodb. conf
![-w769](/img/15616460277653.jpg)

## 实验出现的问题及解决方案 
中间踩的坑,用 kill -9 进程强制停止服务,造成了服务被锁死 ,查看官方文档*https://docs.mongodb.org/manual/tutorial/manage-mongodb-processes/*
![-w730](/img/15616413783609.jpg)
有集中方式,但是文档特别强调不能强制关闭</br>
**理由是**：千万不能使用kill -9 <pid>,因为MongoDB使用mmap方式进行数据文件管理，也就是说写操作基本是在内存中进行，写操作会被每隔60秒(syncdelay设定)的flush到磁盘里。如果在这60秒内flush处于停止事情我们进行kill -9那么从上次flush之后的写入数据将会全部丢失。
如果在flush操作进行时执行kill -9则会造成文件混乱，可能导致数据全丢了，启动时加了repair也无法恢复。


##集群配置



